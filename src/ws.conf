# Define the worker processes
worker_processes 1;  # Número de procesos de trabajo (worker processes) que NGINX debe crear. Un valor de 1 es adecuado para pruebas locales o entornos de desarrollo. En producción, se recomienda configurar este valor según el número de núcleos de CPU disponibles.

# Set the maximum body size for client uploads
client_max_body_size 10M;  # Define el tamaño máximo permitido para el cuerpo de una solicitud HTTP (en este caso, 10MB). Si se excede este tamaño, NGINX rechazará la solicitud.

# Log configuration
access_log /var/log/nginx/access.log;  # Archivo donde se registrarán las solicitudes HTTP exitosas. El archivo de acceso debe ser legible por el usuario que ejecuta NGINX.
error_log /var/log/nginx/error.log;  # Archivo donde se registrarán los errores de NGINX.

# Main HTTP block
http {
    # Set the default MIME type
    include       mime.types;  # Incluye el archivo mime.types, que contiene las asignaciones de tipo MIME (como text/html, application/json, etc.) a las extensiones de archivos. NGINX usará estos tipos para entregar correctamente los archivos.
    default_type  text/html;  # Define el tipo MIME por defecto cuando no se puede determinar el tipo desde el archivo o el encabezado.
    # Configure the first server for a host:port combination
    server {
        keepalive_timeout 0;
        keepalive_requests 1;

        # Listen on port 8080 for localhost (default)
        listen 8080;  # Especifica el puerto en el que NGINX escuchará las solicitudes. En este caso, el servidor escuchará en el puerto 8080.
        server_name localhost;  # Define el nombre del servidor, en este caso "localhost". NGINX usará este nombre para identificar qué bloque de servidor manejará la solicitud.

        location /html/ {
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            root /html;
            index index.html;  # Si no se especifica un archivo en la URL, NGINX buscará y servirá el archivo "index.html".
        }
        # Define a default error page
        error_page 404 /404.html;  # Si ocurre un error 404 (recurso no encontrado), NGINX redirigirá al cliente a la página /404.html.
        location = /404.html {  # Cuando la solicitud sea para /404.html, se configurará este bloque location para servir la página de error.
            root /usr/share/nginx/html;  # El archivo /404.html se buscará en la ruta /usr/share/nginx/html.
        }

        # Limit the client body size for uploads
        client_max_body_size 5M;  # Limita el tamaño máximo del cuerpo de la solicitud a 5 MB para este bloque de servidor.

        # Configure routes with allowed HTTP methods
        location /api {  # Para las solicitudes que coincidan con la ruta /api, se configurará este bloque location.
            # Accept only GET and POST methods
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            # Serve content from a directory
            root /var/www/api;  # El contenido de esta ruta se servirá desde el directorio /var/www/api.
            index index.html;  # Si no se especifica un archivo en la URL, NGINX buscará y servirá el archivo "index.html".
        }

        # Redirect route example
        location /old-page {  # Si la solicitud es para /old-page, se configurará este bloque.
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            return 301 http://localhost:8080/cgi-bin/login.py;  # Redirige permanentemente (código HTTP 301) a la URL /new-page.
        }

        # Define route that serves static files with directory listing enabled
        location /files/ {  # Si la solicitud es para la ruta /files/, se configurará este bloque.
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            root /cgi-bin/files/;  # Los archivos estáticos se servirán desde /var/www/static.
            autoindex on;  # Activa el listado de directorios. Si la solicitud es para un directorio, NGINX mostrará el contenido del directorio en lugar de un 404.
        }

        # Serve a directory with a default file if it's a directory
        location /content/ {  # Si la solicitud es para /content/, se configurará este bloque.
            root /var/www/content;  # Los archivos de contenido se servirán desde /var/www/content.
            index index.html;  # Si la solicitud es para un directorio, NGINX buscará y servirá el archivo index.html.
        }

        # Handle CGI execution for PHP scripts
        location ~ \.php$ {  # Si la solicitud es para un archivo que termine en .php, se configurará este bloque.
            fastcgi_pass 127.0.0.1:9000;  # Redirige la solicitud a un servidor FastCGI en el puerto 9000 (comúnmente usado con PHP-FPM).
            fastcgi_index index.php;  # Define el archivo de índice predeterminado para los scripts PHP.
            fastcgi_param SCRIPT_FILENAME /var/www/html$fastcgi_script_name;  # Especifica el archivo PHP a ejecutar, concatenando el directorio base y el nombre del script.
            include fastcgi_params;  # Incluye el archivo fastcgi_params que contiene variables necesarias para la configuración de FastCGI.
        }

        # Handle file uploads
        location /cgi-bin/ {  # Si la solicitud es para /upload/, se configurará este bloque.
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            client_max_body_size 20M;  # Limita el tamaño máximo del archivo cargado a 20 MB.
            root /cgi-bin;  # Define el directorio donde se guardarán los archivos subidos.
            index login.py;
        }
    }

    # Second server block with a different host:port
    server {
        listen 8081;  # Escucha en el puerto 8081 para este servidor.
        server_name example.com;  # El nombre del servidor es "example.com".

        # Default error page for this server
        error_page 404 /404.html;  # Redirige a /404.html si ocurre un error 404.
        location = /404.html {
            root /usr/share/nginx/html;  # La página de error 404 se buscará en /usr/share/nginx/html.
        }

        # Serve static files
        location /static/ {  # Si la solicitud es para la ruta /static/, se configurará este bloque.
            root /var/www/static;  # Los archivos estáticos se servirán desde /var/www/static.
        }

        location /images/ {
            autoindex on;  # Activa el listado de directorios. Si la solicitud es para un directorio, NGINX mostrará el contenido del directorio en lugar de un 404.
            root /img/www;
        }
        # Handle PHP files (if needed)
        location /cgi-bin/ {  # Si la solicitud es para un archivo PHP, se configurará este bloque.
            limit_except GET POST {  # Permite solo los métodos GET y POST. Otros métodos HTTP como PUT o DELETE serán rechazados.
                deny all;  # Niega todos los demás métodos.
            }
            client_max_body_size 20M;  # Limita el tamaño máximo del archivo cargado a 20 MB.
            root /cgi-bin;  # Define el directorio donde se guardarán los archivos subidos.
            autoindex on;
        }

        # Redirect HTTP requests to HTTPS (if necessary)
        location /secure/ {  # Si la solicitud es para /secure/, se configurará este bloque.
            return 301 https://example.com/secure;  # Redirige la solicitud a la versión HTTPS.
        }


    }


}
